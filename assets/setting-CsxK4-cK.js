import{i as F,r as n,x as B,y as z,j as e,z as G,D,F as J,G as q,H as V,m as P,A as _,J as b,B as E,e as C,K as Y,g as S,t as w,N as W,I as k}from"./index-BXht6M4J.js";/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=[["path",{d:"M16 5h6",key:"1vod17"}],["path",{d:"M19 2v6",key:"4bpg5p"}],["path",{d:"M21 11.5V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7.5",key:"1ue2ih"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}]],Q=F("image-plus",K);/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],X=F("save",Z);var I="Switch",[ee,oe]=G(I),[se,ae]=ee(I),$=n.forwardRef((s,i)=>{const{__scopeSwitch:c,name:g,checked:h,defaultChecked:v,required:l,disabled:u,value:m="on",onCheckedChange:j,form:d,...x}=s,[p,t]=n.useState(null),f=B(i,y=>t(y)),a=n.useRef(!1),o=p?d||!!p.closest("form"):!0,[r,N]=z({prop:h,defaultProp:v??!1,onChange:j,caller:I});return e.jsxs(se,{scope:c,checked:r,disabled:u,children:[e.jsx(D.button,{type:"button",role:"switch","aria-checked":r,"aria-required":l,"data-state":L(r),"data-disabled":u?"":void 0,disabled:u,value:m,...x,ref:f,onClick:J(s.onClick,y=>{N(H=>!H),o&&(a.current=y.isPropagationStopped(),a.current||y.stopPropagation())})}),o&&e.jsx(T,{control:p,bubbles:!a.current,name:g,value:m,checked:r,required:l,disabled:u,form:d,style:{transform:"translateX(-100%)"}})]})});$.displayName=I;var O="SwitchThumb",M=n.forwardRef((s,i)=>{const{__scopeSwitch:c,...g}=s,h=ae(O,c);return e.jsx(D.span,{"data-state":L(h.checked),"data-disabled":h.disabled?"":void 0,...g,ref:i})});M.displayName=O;var te="SwitchBubbleInput",T=n.forwardRef(({__scopeSwitch:s,control:i,checked:c,bubbles:g=!0,...h},v)=>{const l=n.useRef(null),u=B(l,v),m=q(c),j=V(i);return n.useEffect(()=>{const d=l.current;if(!d)return;const x=window.HTMLInputElement.prototype,t=Object.getOwnPropertyDescriptor(x,"checked").set;if(m!==c&&t){const f=new Event("click",{bubbles:g});t.call(d,c),d.dispatchEvent(f)}},[m,c,g]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:c,...h,tabIndex:-1,ref:u,style:{...h.style,...j,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});T.displayName=te;function L(s){return s?"checked":"unchecked"}var U=$,re=M;const R=n.forwardRef(({className:s,...i},c)=>e.jsx(U,{className:P("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",s),...i,ref:c,children:e.jsx(re,{className:P("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));R.displayName=U.displayName;function A({type:s,currentImage:i,onUploadSuccess:c,onDeleteSuccess:g}){const[h,v]=n.useState(!1),[l,u]=n.useState(!1),m=n.useRef(null),j=n.useContext(_);if(!j)throw new Error("AppContext must be used within an AppProvider");const{token:d}=j,x=async t=>{var a;const f=(a=t.target.files)==null?void 0:a[0];if(!(!f||!d))try{v(!0);const o=new FormData;o.append("file",f),o.append("type",s);const r=await fetch(`${S.backend_url}/api/upload`,{headers:{Authorization:`Bearer ${d}`},method:"POST",body:o});if(!r.ok)throw new Error("Upload failed");const N=await r.json();console.log("HEY",N),c(N.url),w.success(`${s==="logo"?"Logo":"Banner"} uploaded successfully`)}catch(o){w.error(`Failed to upload ${s}`),console.error(o)}finally{v(!1),m.current&&(m.current.value="")}},p=async()=>{if(!(!i||!d))try{if(u(!0),!(await fetch(`${S.backend_url}/api/delete-image`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${d}`},body:JSON.stringify({url:i})})).ok)throw new Error("Delete failed");g(),w.success(`${s==="logo"?"Logo":"Banner"} removed successfully`)}catch(t){w.error(`Failed to remove ${s}`),console.error(t)}finally{u(!1)}};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(b,{children:[s==="logo"?"Logo":"Banner"," Image"]}),i?e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:`overflow-hidden rounded-md ${s==="logo"?"w-32 h-32":"w-full h-48"}`,children:e.jsx("img",{src:i,alt:s==="logo"?"Restaurant logo":"Restaurant banner",className:`w-full h-full object-${s==="logo"?"contain":"cover"}`})}),e.jsx("div",{className:"absolute inset-0 bg-black/30 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-2",children:e.jsxs(E,{variant:"destructive",size:"sm",onClick:p,disabled:l,children:[l?e.jsx(C,{className:"h-4 w-4 animate-spin"}):e.jsx(Y,{className:"h-4 w-4"}),"Remove"]})})]}):e.jsxs("div",{className:`border-2 border-dashed rounded-md flex flex-col items-center justify-center p-6 cursor-pointer hover:bg-gray-50 transition-colors ${s==="logo"?"w-32 h-32":"w-full h-48"}`,onClick:()=>{var t;return(t=m.current)==null?void 0:t.click()},children:[e.jsx("input",{type:"file",ref:m,onChange:x,accept:"image/*",className:"hidden"}),h?e.jsx(C,{className:"h-8 w-8 animate-spin text-gray-400"}):e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"h-8 w-8 text-gray-400 mb-2"}),e.jsxs("span",{className:"text-sm text-gray-500 text-center",children:["Click to upload ",s]})]})]})]})}function ie(){const[s,i]=n.useState({name:"",address:"",whatsapp:"",phone:"",instagram:"",settings:{}}),[c,g]=n.useState(s),[h,v]=n.useState(!1),[l,u]=n.useState(!1),[m,j]=n.useState(!0),d=n.useContext(_);if(!d)throw new Error("AppContext must be used within an AppProvider");const{token:x}=d;n.useEffect(()=>{if(!x)return;(async()=>{try{const o=await fetch(`${S.backend_url}/api/restaurant-by-user`,{headers:{Authorization:`Bearer ${x}`,Accept:"application/json"}});if(!o.ok)throw new Error("Failed to fetch restaurant");const r=await o.json();if(r.success&&r.data){const N=r.data.settings||{},y={...r.data,settings:N};i(y),g(y)}else throw new Error(r.message||"Restaurant not found")}catch(o){w.error("Failed to load restaurant"),console.error(o)}finally{j(!1)}})()},[x]),n.useEffect(()=>{const a=JSON.stringify(s)!==JSON.stringify(c);v(a)},[s,c]);const p=(a,o)=>{i(r=>({...r,[a]:o}))},t=(a,o)=>{i(r=>({...r,settings:{...r.settings,[a]:o}}))},f=async()=>{if(!x){w.error("You must be logged in to update.");return}try{u(!0);const a=await fetch(`${S.backend_url}/api/update-restaurant`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${x}`,Accept:"application/json"},body:JSON.stringify({name:s.name,address:s.address,whatsapp:s.whatsapp,phone:s.phone,instagram:s.instagram,settings:{isGrid:s.settings.isGrid??null,isOrder:s.settings.isOrder??null,facebook:s.settings.facebook??null,bannerImage:s.settings.bannerImage??null,logoImage:s.settings.logoImage??null}})});if(!a.ok){const r=await a.json();throw new Error(r.message||"Failed to update")}const o=await a.json();g({...s,settings:o.data.settings||{}}),w.success("Changes saved successfully")}catch(a){w.error("Failed to save changes"),console.error(a)}finally{u(!1)}};return m?e.jsx(W,{}):e.jsxs("div",{className:"space-y-6 p-4 md:p-6 max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Restaurant Settings"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Manage your restaurant details and preferences"})]}),e.jsxs(E,{onClick:f,disabled:l||!h,className:"w-full md:w-auto",children:[l?e.jsx(C,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(X,{className:"mr-2 h-4 w-4"}),"Save Changes",h&&!l&&e.jsx("span",{className:"ml-2 text-xs bg-amber-100 text-amber-800 px-2 py-0.5 rounded-full",children:"Unsaved"})]})]}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"bg-white rounded-lg border p-6 shadow-sm",children:[e.jsx("h2",{className:"text-xl font-semibold mb-6 pb-2 border-b",children:"Images"}),e.jsxs("div",{className:"grid gap-8 md:grid-cols-2",children:[e.jsx(A,{type:"logo",currentImage:s.settings.logoImage||void 0,onUploadSuccess:a=>t("logoImage",a),onDeleteSuccess:()=>t("logoImage",null)}),e.jsx(A,{type:"banner",currentImage:s.settings.bannerImage||void 0,onUploadSuccess:a=>t("bannerImage",a),onDeleteSuccess:()=>t("bannerImage",null)})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border p-6 shadow-sm",children:[e.jsx("h2",{className:"text-xl font-semibold mb-6 pb-2 border-b",children:"Restaurant Information"}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"name",children:"Business Name"}),e.jsx(k,{id:"name",value:s.name,onChange:a=>p("name",a.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"address",children:"Address"}),e.jsx(k,{id:"address",value:s.address,onChange:a=>p("address",a.target.value),placeholder:"Enter your restaurant address"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(b,{htmlFor:"isOrder",children:"Enable Online Orders"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Allow customers to place orders online"})]}),e.jsx(R,{id:"isOrder",checked:!!s.settings.isOrder,onCheckedChange:a=>t("isOrder",a)})]}),e.jsxs("div",{className:"space-y-2 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(b,{htmlFor:"isGrid",children:"Display Menu as Grid"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Show menu items in a grid layout instead of list"})]}),e.jsx(R,{id:"isGrid",checked:!!s.settings.isGrid,onCheckedChange:a=>t("isGrid",a)})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border p-6 shadow-sm",children:[e.jsx("h2",{className:"text-xl font-semibold mb-6 pb-2 border-b",children:"Contact Information"}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"whatsapp",children:"WhatsApp Number"}),e.jsx(k,{id:"whatsapp",value:s.whatsapp,onChange:a=>p("whatsapp",a.target.value),required:!0,placeholder:"+91XXXXXXXXXX"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Customers will contact you on this number"})]})}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"phone",children:"Phone Number"}),e.jsx(k,{id:"phone",value:s.phone,onChange:a=>p("phone",a.target.value),placeholder:"+91XXXXXXXXXX"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Additional contact number (optional)"})]})})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border p-6 shadow-sm",children:[e.jsx("h2",{className:"text-xl font-semibold mb-6 pb-2 border-b",children:"Social Media"}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"instagram",children:"Instagram Handle"}),e.jsx(k,{id:"instagram",value:s.instagram,onChange:a=>p("instagram",a.target.value),placeholder:"@yourhandle"})]})}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"facebook",children:"Facebook Page"}),e.jsx(k,{id:"facebook",placeholder:"https://facebook.com/yourpage",value:s.settings.facebook||"",onChange:a=>t("facebook",a.target.value)})]})})]})]})]}),h&&e.jsxs("div",{className:"fixed bottom-4 right-4 bg-white p-4 rounded-lg shadow-lg border border-amber-200 flex items-center gap-4",children:[e.jsx("div",{className:"text-amber-800",children:"You have unsaved changes"}),e.jsxs(E,{onClick:f,disabled:l,size:"sm",className:"bg-amber-600 hover:bg-amber-700",children:[l?e.jsx(C,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(X,{className:"mr-2 h-4 w-4"}),"Save"]})]})]})}export{ie as default};
